<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Parsing DrugBank XML (or any large XML file) in streaming mode in Go | Living Systems_</title>

      <link rel="stylesheet" href="/css/main.min.029837f0c3987a286167e526bfc9b74e9962449d138fc3d09f34d1bad58ff017.css" integrity="sha256-Apg38MOYeihhZ&#43;Umv8m3TpliRJ0Tj8PQnzTRutWP8Bc=" crossorigin="anonymous">


      <script src="/js/main.23cd0c7d837263b9eaeb96ee2d9ccfa2969daa3fa00fa1c1fe8701a9b87251a1.js" integrity="sha256-I80MfYNyY7nq65buLZzPopadqj&#43;gD6HB/ocBqbhyUaE=" crossorigin="anonymous"></script>




</head>
<body>
  <header>
    <h1><a href="/">Living Systems_</a></h1>

  <nav>
    <ul>
    <li>
      <a href="/">Home</a>
    </li>
    <li>
      <a aria-current="true" class="ancestor" href="/posts/">Posts</a>
    </li>
    <li>
      <a href="/tags/">Tags</a>
    </li>
    <li>
      <a href="/about/">About</a>
    </li>
    </ul>
  </nav>


  </header>
  <main>
    
  <h1>Parsing DrugBank XML (or any large XML file) in streaming mode in Go</h1>

  
  
  
  <time datetime="2018-03-15T15:19:00&#43;01:00">March 15, 2018</time>

  <p>I had a problem in which I thought I needed to parse the full
<a href="https://www.drugbank.ca" target="_blank" rel="noopener">DrugBank</a>
 dataset, which comes as a <a href="https://www.drugbank.ca/releases/5-0-11/downloads/all-full-database" target="_blank" rel="noopener">(670MB) XML file</a>
</p>
<p>(For open access papers describing DrugBank, see: <!-- raw HTML omitted -->[1]<!-- raw HTML omitted -->, <!-- raw HTML omitted -->[2]<!-- raw HTML omitted -->, <!-- raw HTML omitted -->[3]<!-- raw HTML omitted --> and <!-- raw HTML omitted -->[4]<!-- raw HTML omitted -->).<!-- raw HTML omitted --> It turned out what I needed was available as CSV
files under &ldquo;<a href="https://www.drugbank.ca/releases/latest#structures" target="_blank" rel="noopener">Structure External
Links</a>
&rdquo;. There is probably
still some other uses of this approach though, as the XML version of DrugBank
seems to contain a lot more information in a single format. And in any case,
this forced me to figure out how to parse large XML files in a streaming
fashion in Go, as older tools like
<a href="http://xmlstar.sourceforge.net/" target="_blank" rel="noopener">XMLStarlet</a>
 chokes for many minutes upon the
DrugBank file (trying to read it all into memory?), killing any attempt at an
iterative development cycle. And, it turns out Go&rsquo;s support for streaming XML
parsing is just great!</p>
<p>While Go&rsquo;s XML stream-parsing support is great, the details of how to
do that in a streaming fashion was not immediately clear from the docs,
and I was thus saved by <a href="http://blog.davidsingleton.org/parsing-huge-xml-files-with-go/" target="_blank" rel="noopener">this blog
post</a>
 by
<a href="http://twitter.com/dps" target="_blank" rel="noopener">David Singleton</a>
. Basically, you could use his
blog post as a starting point, but I wanted to write up my own post to
document some specifics and peculiarities I figured out.</p>
<h2 id="idea-parse-drugbank-xml-to-tsv">Idea: Parse DrugBank XML to TSV</h2>
<p>So in short, we want to parse the DrugBank XML, which contains tons of
hierarchical information about each drug in the dataset, and extract
just a few fields, and output that into a nicely formatted tab-separated
(.tsv) file.</p>
<p>The fields which we want to extract in this example (which is based on
my real world problem mentioned above) for each drug are:</p>
<ul>
<li>InchiKey (a hashed ID representing a chemical structure)</li>
<li>Approved/Withdrawn status</li>
<li>ChEMBL ID (for the compound)</li>
<li>PubChem Compound ID (CID)</li>
<li>PubChem Substance ID (SID)</li>
</ul>
<h2 id="the-drugbank-xml-format">The DrugBank XML format</h2>
<p>The DrugBank XML format is a pretty simple one on its highest level: It
is basically a lot of <!-- raw HTML omitted --><!-- raw HTML omitted --> elements thrown into a
<!-- raw HTML omitted --><!-- raw HTML omitted --> enclosing tag. The relative complexity comes
within the <!-- raw HTML omitted --> tag. But because of how Go parses XML to structs
using tags, we can just skip most of that info, and only focus on the
parts we are interested in.</p>
<p>A schematic example of the DrugBank XML containing only the fields we
are interested could look like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#633820">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">&lt;drugbank</span> <span style="color:#836c28">xmlns=</span><span style="color:#c41a16">&#34;http://www.drugbank.ca&#34;</span> <span style="color:#836c28">xmlns:xsi=</span><span style="color:#c41a16">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span> <span style="color:#836c28">xsi:schemaLocation=</span><span style="color:#c41a16">&#34;http://www.drugbank.ca http://www.drugbank.ca/docs/drugbank.xsd&#34;</span> <span style="color:#836c28">version=</span><span style="color:#c41a16">&#34;5.0&#34;</span> <span style="color:#836c28">exported-on=</span><span style="color:#c41a16">&#34;2017-12-20&#34;</span><span style="color:#000">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">&lt;drug</span> <span style="color:#836c28">type=</span><span style="color:#c41a16">&#34;small molecule&#34;</span> <span style="color:#836c28">created=</span><span style="color:#c41a16">&#34;2005-06-13&#34;</span> <span style="color:#836c28">updated=</span><span style="color:#c41a16">&#34;2017-12-19&#34;</span><span style="color:#000">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">&lt;name&gt;</span>Bivalirudin<span style="color:#000">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">&lt;groups&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;group&gt;</span>approved<span style="color:#000">&lt;/group&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;group&gt;</span>investigational<span style="color:#000">&lt;/group&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">&lt;/groups&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">&lt;external-identifiers&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;external-identifier&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">&lt;resource&gt;</span>PubChem Compound<span style="color:#000">&lt;/resource&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">&lt;identifier&gt;</span>16129704<span style="color:#000">&lt;/identifier&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;/external-identifier&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;external-identifier&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">&lt;resource&gt;</span>PubChem Substance<span style="color:#000">&lt;/resource&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">&lt;identifier&gt;</span>46507415<span style="color:#000">&lt;/identifier&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;/external-identifier&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;external-identifier&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">&lt;resource&gt;</span>ChEMBL<span style="color:#000">&lt;/resource&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">&lt;identifier&gt;</span>CHEMBL2103749<span style="color:#000">&lt;/identifier&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;/external-identifier&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">&lt;/external-identifiers&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">&lt;calculated-properties&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">&lt;kind&gt;</span>InChIKey<span style="color:#000">&lt;/kind&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">&lt;value&gt;</span>OIRCOABEOLEUMC-GEJPAHFPSA-N<span style="color:#000">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">&lt;source&gt;</span>ChemAxon<span style="color:#000">&lt;/source&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">&lt;/calculated-properties&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">&lt;/drug&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">&lt;/drugbank&gt;</span>
</span></span></code></pre></div><p>(In reality, each <!-- raw HTML omitted --> element is far far many more lines than this,
which really necessitates proper XML parsing tools).</p>
<h2 id="mapping-xml-to-go-structs">Mapping XML to Go Structs</h2>
<p>The parsing strategy for XML in Go, is the same as for other formats
such as JSON: Define one or more structs into which we parse certain XML
elements and attributes. The mapping between XML (or JSON) and the
struct fields are done using so called &ldquo;tags&rdquo; which are added within
back-quotes after the fields in the struct definition. Thus, defining
sensible structs and XML element-to-struct field mappings is the core of
the work, and will directly influence how easy your code will be to work
with.</p>
<p>Below you can see the struct-structure (sounds just right, right?) I
defined to be able to parse out the data I&rsquo;m interested in:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a90d91">type</span> <span style="color:#000">Drugbank</span> <span style="color:#a90d91">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000">XMLName</span> <span style="color:#000">xml</span>.<span style="color:#000">Name</span> <span style="color:#c41a16">`xml:&#34;drugbank&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Drugs</span>   []<span style="color:#000">Drug</span>   <span style="color:#c41a16">`xml:&#34;drug&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">type</span> <span style="color:#000">Drug</span> <span style="color:#a90d91">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000">XMLName</span>              <span style="color:#000">xml</span>.<span style="color:#000">Name</span>             <span style="color:#c41a16">`xml:&#34;drug&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Name</span>                 <span style="color:#a90d91">string</span>               <span style="color:#c41a16">`xml:&#34;name&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Groups</span>               []<span style="color:#a90d91">string</span>             <span style="color:#c41a16">`xml:&#34;groups&gt;group&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">CalculatedProperties</span> []<span style="color:#000">Property</span>           <span style="color:#c41a16">`xml:&#34;calculated-properties&gt;property&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ExternalIdentifiers</span>  []<span style="color:#000">ExternalIdentifier</span> <span style="color:#c41a16">`xml:&#34;external-identifiers&gt;external-identifier&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">type</span> <span style="color:#000">Property</span> <span style="color:#a90d91">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000">XMLName</span> <span style="color:#000">xml</span>.<span style="color:#000">Name</span> <span style="color:#c41a16">`xml:&#34;property&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Kind</span>    <span style="color:#a90d91">string</span>   <span style="color:#c41a16">`xml:&#34;kind&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Value</span>   <span style="color:#a90d91">string</span>   <span style="color:#c41a16">`xml:&#34;value&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Source</span>  <span style="color:#a90d91">string</span>   <span style="color:#c41a16">`xml:&#34;source&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">type</span> <span style="color:#000">ExternalIdentifier</span> <span style="color:#a90d91">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000">XMLName</span>    <span style="color:#000">xml</span>.<span style="color:#000">Name</span> <span style="color:#c41a16">`xml:&#34;external-identifier&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Resource</span>   <span style="color:#a90d91">string</span>   <span style="color:#c41a16">`xml:&#34;resource&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Identifier</span> <span style="color:#a90d91">string</span>   <span style="color:#c41a16">`xml:&#34;identifier&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>We can note the following:</p>
<ul>
<li>As said, the stuff within back-quotes represent the structure in the
XML to be mapped to a certain field.</li>
<li>Note how, for nested hierarchies, we need multiple struct types,
such as the &ldquo;Property&rdquo; and &ldquo;ExternalIdentifier&rdquo; ones &hellip; which
are then linked to from the main &ldquo;Drug&rdquo; struct&quot;.</li>
<li>We also need a struct for the highest level element, <!-- raw HTML omitted -->.</li>
<li>Each struct needs to have a field of xml.Name type (named XMLName
for simplicity), that defines its name in the XML, so that we have
somewhere to add our XML-mapping tag.</li>
<li>Note, when we have a slice (&ldquo;list&rdquo;) of things, such as the
&ldquo;CalculatedProperties&rdquo; field in the &ldquo;Drug&rdquo; struct, how we need
to specify a two level path
(<code>xml:&quot;calculated-properties**&gt;**property&quot;</code>) into the XML
structure, so that we get down to the individual &ldquo;property&rdquo; XML
elements which are placed inside a grouping
&ldquo;calculated-properties&rdquo; element.</li>
</ul>
<p>With that set up, we can create our Go code to loop over our XML file in
a streaming fashion, along the lines of David&rsquo;s <a href="http://blog.davidsingleton.org/parsing-huge-xml-files-with-go/" target="_blank" rel="noopener">blog
post</a>
,
while also creating a TSV writer, which we use to stream-write our
extracted output into a new file, drugbank_extracted.tsv (imports and
main function left out for brevity):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">xmlFile</span>, <span style="color:#000">err</span> <span style="color:#000">:=</span> <span style="color:#000">os</span>.<span style="color:#000">Open</span>(<span style="color:#c41a16">&#34;drugbank.xml&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a90d91">if</span> <span style="color:#000">err</span> <span style="color:#000">!=</span> <span style="color:#a90d91">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">panic</span>(<span style="color:#c41a16">&#34;Could not open file: drugbank.xml&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">tsvFile</span>, <span style="color:#000">err</span> <span style="color:#000">:=</span> <span style="color:#000">os</span>.<span style="color:#000">Create</span>(<span style="color:#c41a16">&#34;drugbank_extracted.tsv&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a90d91">if</span> <span style="color:#000">err</span> <span style="color:#000">!=</span> <span style="color:#a90d91">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">panic</span>(<span style="color:#c41a16">&#34;Could not create file: drugbank_extracted.tsv&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">tsvWrt</span> <span style="color:#000">:=</span> <span style="color:#000">csv</span>.<span style="color:#000">NewWriter</span>(<span style="color:#000">tsvFile</span>)
</span></span><span style="display:flex;"><span><span style="color:#000">tsvWrt</span>.<span style="color:#000">Comma</span> = <span style="color:#2300ce">&#39;\t&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">tsvHeader</span> <span style="color:#000">:=</span> []<span style="color:#a90d91">string</span>{<span style="color:#c41a16">&#34;inchikey&#34;</span>, <span style="color:#c41a16">&#34;status&#34;</span>, <span style="color:#c41a16">&#34;chembl_id&#34;</span>, <span style="color:#c41a16">&#34;pubchem_sid&#34;</span>, <span style="color:#c41a16">&#34;pubchem_cid&#34;</span>}
</span></span><span style="display:flex;"><span><span style="color:#000">tsvWrt</span>.<span style="color:#000">Write</span>(<span style="color:#000">tsvHeader</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#177500">// Implement a streaming XML parser according to guide in
</span></span></span><span style="display:flex;"><span><span style="color:#177500">// http://blog.davidsingleton.org/parsing-huge-xml-files-with-go
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span><span style="color:#000">xmlDec</span> <span style="color:#000">:=</span> <span style="color:#000">xml</span>.<span style="color:#000">NewDecoder</span>(<span style="color:#000">xmlFile</span>)
</span></span><span style="display:flex;"><span><span style="color:#a90d91">for</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000">t</span>, <span style="color:#000">tokenErr</span> <span style="color:#000">:=</span> <span style="color:#000">xmlDec</span>.<span style="color:#000">Token</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">if</span> <span style="color:#000">tokenErr</span> <span style="color:#000">!=</span> <span style="color:#a90d91">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">if</span> <span style="color:#000">tokenErr</span> <span style="color:#000">==</span> <span style="color:#000">io</span>.<span style="color:#000">EOF</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">break</span>
</span></span><span style="display:flex;"><span>        } <span style="color:#a90d91">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">panic</span>(<span style="color:#c41a16">&#34;Failed to read token:&#34;</span> <span style="color:#000">+</span> <span style="color:#000">tokenErr</span>.<span style="color:#000">Error</span>())
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">switch</span> <span style="color:#000">startElem</span> <span style="color:#000">:=</span> <span style="color:#000">t</span>.(<span style="color:#a90d91">type</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">case</span> <span style="color:#000">xml</span>.<span style="color:#000">StartElement</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">if</span> <span style="color:#000">startElem</span>.<span style="color:#000">Name</span>.<span style="color:#000">Local</span> <span style="color:#000">==</span> <span style="color:#c41a16">&#34;drug&#34;</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">var</span> <span style="color:#000">status</span> <span style="color:#a90d91">string</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">var</span> <span style="color:#000">inchiKey</span> <span style="color:#a90d91">string</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">var</span> <span style="color:#000">chemblID</span> <span style="color:#a90d91">string</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">var</span> <span style="color:#000">pubchemSID</span> <span style="color:#a90d91">string</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">var</span> <span style="color:#000">pubchemCID</span> <span style="color:#a90d91">string</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">drug</span> <span style="color:#000">:=</span> <span style="color:#000">&amp;</span><span style="color:#000">Drug</span>{}
</span></span><span style="display:flex;"><span>            <span style="color:#000">decErr</span> <span style="color:#000">:=</span> <span style="color:#000">xmlDec</span>.<span style="color:#000">DecodeElement</span>(<span style="color:#000">drug</span>, <span style="color:#000">&amp;</span><span style="color:#000">startElem</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">if</span> <span style="color:#000">err</span> <span style="color:#000">!=</span> <span style="color:#a90d91">nil</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">panic</span>(<span style="color:#c41a16">&#34;Could not decode element&#34;</span> <span style="color:#000">+</span> <span style="color:#000">decErr</span>.<span style="color:#000">Error</span>())
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">for</span> <span style="color:#000">_</span>, <span style="color:#000">g</span> <span style="color:#000">:=</span> <span style="color:#a90d91">range</span> <span style="color:#000">drug</span>.<span style="color:#000">Groups</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">if</span> <span style="color:#000">g</span> <span style="color:#000">==</span> <span style="color:#c41a16">&#34;approved&#34;</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#000">status</span> = <span style="color:#c41a16">&#34;A&#34;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#177500">// Withdrawn till &#34;shadow&#34; (what&#39;s the correct term?) approved status
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>                <span style="color:#a90d91">if</span> <span style="color:#000">g</span> <span style="color:#000">==</span> <span style="color:#c41a16">&#34;withdrawn&#34;</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#000">status</span> = <span style="color:#c41a16">&#34;W&#34;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">for</span> <span style="color:#000">_</span>, <span style="color:#000">p</span> <span style="color:#000">:=</span> <span style="color:#a90d91">range</span> <span style="color:#000">drug</span>.<span style="color:#000">CalculatedProperties</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">if</span> <span style="color:#000">p</span>.<span style="color:#000">Kind</span> <span style="color:#000">==</span> <span style="color:#c41a16">&#34;InChIKey&#34;</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#000">inchiKey</span> = <span style="color:#000">p</span>.<span style="color:#000">Value</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">for</span> <span style="color:#000">_</span>, <span style="color:#000">eid</span> <span style="color:#000">:=</span> <span style="color:#a90d91">range</span> <span style="color:#000">drug</span>.<span style="color:#000">ExternalIdentifiers</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">if</span> <span style="color:#000">eid</span>.<span style="color:#000">Resource</span> <span style="color:#000">==</span> <span style="color:#c41a16">&#34;ChEMBL&#34;</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#000">chemblID</span> = <span style="color:#000">eid</span>.<span style="color:#000">Identifier</span>
</span></span><span style="display:flex;"><span>                } <span style="color:#a90d91">else</span> <span style="color:#a90d91">if</span> <span style="color:#000">eid</span>.<span style="color:#000">Resource</span> <span style="color:#000">==</span> <span style="color:#c41a16">&#34;PubChem Substance&#34;</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#000">pubchemSID</span> = <span style="color:#000">eid</span>.<span style="color:#000">Identifier</span>
</span></span><span style="display:flex;"><span>                } <span style="color:#a90d91">else</span> <span style="color:#a90d91">if</span> <span style="color:#000">eid</span>.<span style="color:#000">Resource</span> <span style="color:#000">==</span> <span style="color:#c41a16">&#34;PubChem Compound&#34;</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#000">pubchemCID</span> = <span style="color:#000">eid</span>.<span style="color:#000">Identifier</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">tsvWrt</span>.<span style="color:#000">Write</span>([]<span style="color:#a90d91">string</span>{<span style="color:#000">inchiKey</span>, <span style="color:#000">status</span>, <span style="color:#000">chemblID</span>, <span style="color:#000">pubchemSID</span>, <span style="color:#000">pubchemCID</span>})
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">case</span> <span style="color:#000">xml</span>.<span style="color:#000">EndElement</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">continue</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#000">tsvWrt</span>.<span style="color:#000">Flush</span>()
</span></span><span style="display:flex;"><span><span style="color:#000">xmlFile</span>.<span style="color:#000">Close</span>()
</span></span><span style="display:flex;"><span><span style="color:#000">tsvFile</span>.<span style="color:#000">Close</span>()
</span></span></code></pre></div><h2 id="turn-into-a-reproducible-workflow-with-scipipe">Turn into a reproducible workflow with SciPipe</h2>
<p>Now, we could use SciPipe (Go-based workflow library I&rsquo;m developing) to
put this into a little workflow, where we also automaticalyl download
the DrugBank data, Unzip it, and run the XML-to-TSV code. See <a href="https://gist.github.com/samuell/fc82fad39e7efda7987fc18173777f7f" target="_blank" rel="noopener">this
gist</a>

for the full workflow code.</p>
<p>To run the Go file in the gist, in short, what you need to do is:</p>
<ul>
<li>Create a file drugbank_userinfo.txt, containing your DrugBank
website username and password, on the form: USERNAME:PASSWORD</li>
<li>Install Go</li>
<li>Install scipipe with
<code>go get github.com/scipipe/scipipe/...</code></li>
<li>Make sure you have curl installed. On Ubuntu:
<code>sudo apt-get install curl</code></li>
</ul>
<p>Then, you should be able to run it, with:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go run drugbank_xml_to_tsv_with_scipipe.go
</span></span></code></pre></div><h2 id="full-scipipe-workflow-code-example">Full SciPipe workflow code example</h2>
<p>I&rsquo;m including the full SciPipe workflow code below as well, for the day
when Github is down ;):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a90d91">package</span> <span style="color:#000">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#c41a16">&#34;encoding/csv&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#c41a16">&#34;encoding/xml&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#c41a16">&#34;io&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#c41a16">&#34;os&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">sp</span> <span style="color:#c41a16">&#34;github.com/scipipe/scipipe&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#177500">// --------------------------------------------------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#177500">// Workflow definition
</span></span></span><span style="display:flex;"><span><span style="color:#177500">// --------------------------------------------------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">func</span> <span style="color:#000">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#000">wf</span> <span style="color:#000">:=</span> <span style="color:#000">sp</span>.<span style="color:#000">NewWorkflow</span>(<span style="color:#c41a16">&#34;exvsdb&#34;</span>, <span style="color:#1c01ce">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// DrugBank XML
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>    <span style="color:#177500">// Note: We need to prepend &#39;../&#39; to the file drugbank_userinfo.txt, because the workflow will be run in a subfolder
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>    <span style="color:#000">download</span> <span style="color:#000">:=</span> <span style="color:#000">wf</span>.<span style="color:#000">NewProc</span>(<span style="color:#c41a16">&#34;download&#34;</span>, <span style="color:#c41a16">&#34;curl -Lfv -o {o:zip} -u $(cat ../drugbank_userinfo.txt) https://www.drugbank.ca/releases/5-0-11/downloads/all-full-database&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000">download</span>.<span style="color:#000">SetOut</span>(<span style="color:#c41a16">&#34;zip&#34;</span>, <span style="color:#c41a16">&#34;dat/drugbank.zip&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">unzip</span> <span style="color:#000">:=</span> <span style="color:#000">wf</span>.<span style="color:#000">NewProc</span>(<span style="color:#c41a16">&#34;unzip&#34;</span>, <span style="color:#c41a16">`unzip -d dat/ {i:zip}; mv &#34;dat/full database.xml&#34; {o:xml}`</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000">unzip</span>.<span style="color:#000">SetOut</span>(<span style="color:#c41a16">&#34;xml&#34;</span>, <span style="color:#c41a16">&#34;dat/drugbank.xml&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000">unzip</span>.<span style="color:#000">In</span>(<span style="color:#c41a16">&#34;zip&#34;</span>).<span style="color:#000">From</span>(<span style="color:#000">download</span>.<span style="color:#000">Out</span>(<span style="color:#c41a16">&#34;zip&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">xmlToTSV</span> <span style="color:#000">:=</span> <span style="color:#000">wf</span>.<span style="color:#000">NewProc</span>(<span style="color:#c41a16">&#34;xml2tsv&#34;</span>, <span style="color:#c41a16">&#34;# Custom Go code with input: {i:xml} and output: {o:tsv}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000">xmlToTSV</span>.<span style="color:#000">SetOut</span>(<span style="color:#c41a16">&#34;tsv&#34;</span>, <span style="color:#c41a16">&#34;{i:xml}.extr.tsv&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000">xmlToTSV</span>.<span style="color:#000">In</span>(<span style="color:#c41a16">&#34;xml&#34;</span>).<span style="color:#000">From</span>(<span style="color:#000">unzip</span>.<span style="color:#000">Out</span>(<span style="color:#c41a16">&#34;xml&#34;</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#000">xmlToTSV</span>.<span style="color:#000">CustomExecute</span> = <span style="color:#000">NewXMLToTSVFunc</span>() <span style="color:#177500">// Getting the custom Go function in a factory method for readability
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">wf</span>.<span style="color:#000">Run</span>()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#177500">// --------------------------------------------------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#177500">// DrugBank struct definitions
</span></span></span><span style="display:flex;"><span><span style="color:#177500">// --------------------------------------------------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">type</span> <span style="color:#000">Drugbank</span> <span style="color:#a90d91">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000">XMLName</span> <span style="color:#000">xml</span>.<span style="color:#000">Name</span> <span style="color:#c41a16">`xml:&#34;drugbank&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Drugs</span>   []<span style="color:#000">Drug</span>   <span style="color:#c41a16">`xml:&#34;drug&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">type</span> <span style="color:#000">Drug</span> <span style="color:#a90d91">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000">XMLName</span>              <span style="color:#000">xml</span>.<span style="color:#000">Name</span>             <span style="color:#c41a16">`xml:&#34;drug&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Name</span>                 <span style="color:#a90d91">string</span>               <span style="color:#c41a16">`xml:&#34;name&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Groups</span>               []<span style="color:#a90d91">string</span>             <span style="color:#c41a16">`xml:&#34;groups&gt;group&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">CalculatedProperties</span> []<span style="color:#000">Property</span>           <span style="color:#c41a16">`xml:&#34;calculated-properties&gt;property&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ExternalIdentifiers</span>  []<span style="color:#000">ExternalIdentifier</span> <span style="color:#c41a16">`xml:&#34;external-identifiers&gt;external-identifier&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">type</span> <span style="color:#000">Property</span> <span style="color:#a90d91">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000">XMLName</span> <span style="color:#000">xml</span>.<span style="color:#000">Name</span> <span style="color:#c41a16">`xml:&#34;property&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Kind</span>    <span style="color:#a90d91">string</span>   <span style="color:#c41a16">`xml:&#34;kind&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Value</span>   <span style="color:#a90d91">string</span>   <span style="color:#c41a16">`xml:&#34;value&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Source</span>  <span style="color:#a90d91">string</span>   <span style="color:#c41a16">`xml:&#34;source&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">type</span> <span style="color:#000">ExternalIdentifier</span> <span style="color:#a90d91">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000">XMLName</span>    <span style="color:#000">xml</span>.<span style="color:#000">Name</span> <span style="color:#c41a16">`xml:&#34;external-identifier&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Resource</span>   <span style="color:#a90d91">string</span>   <span style="color:#c41a16">`xml:&#34;resource&#34;`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Identifier</span> <span style="color:#a90d91">string</span>   <span style="color:#c41a16">`xml:&#34;identifier&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#177500">// --------------------------------------------------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#177500">// Components
</span></span></span><span style="display:flex;"><span><span style="color:#177500">// --------------------------------------------------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>
</span></span><span style="display:flex;"><span><span style="color:#177500">// NewXMLToTSVFunc returns a CustomExecute function to be used by the XML to TSV
</span></span></span><span style="display:flex;"><span><span style="color:#177500">// component in the workflow above
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span><span style="color:#a90d91">func</span> <span style="color:#000">NewXMLToTSVFunc</span>() <span style="color:#a90d91">func</span>(<span style="color:#000">t</span> <span style="color:#000">*</span><span style="color:#000">sp</span>.<span style="color:#000">Task</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">return</span> <span style="color:#a90d91">func</span>(<span style="color:#000">t</span> <span style="color:#000">*</span><span style="color:#000">sp</span>.<span style="color:#000">Task</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#000">fh</span>, <span style="color:#000">err</span> <span style="color:#000">:=</span> <span style="color:#000">os</span>.<span style="color:#000">Open</span>(<span style="color:#000">t</span>.<span style="color:#000">InPath</span>(<span style="color:#c41a16">&#34;xml&#34;</span>))
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">if</span> <span style="color:#000">err</span> <span style="color:#000">!=</span> <span style="color:#a90d91">nil</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#000">sp</span>.<span style="color:#000">Fail</span>(<span style="color:#c41a16">&#34;Could not open file&#34;</span>, <span style="color:#000">t</span>.<span style="color:#000">InPath</span>(<span style="color:#c41a16">&#34;xml&#34;</span>))
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">tsvWrt</span> <span style="color:#000">:=</span> <span style="color:#000">csv</span>.<span style="color:#000">NewWriter</span>(<span style="color:#000">t</span>.<span style="color:#000">OutIP</span>(<span style="color:#c41a16">&#34;tsv&#34;</span>).<span style="color:#000">OpenWriteTemp</span>())
</span></span><span style="display:flex;"><span>        <span style="color:#000">tsvWrt</span>.<span style="color:#000">Comma</span> = <span style="color:#2300ce">&#39;\t&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">tsvHeader</span> <span style="color:#000">:=</span> []<span style="color:#a90d91">string</span>{<span style="color:#c41a16">&#34;inchikey&#34;</span>, <span style="color:#c41a16">&#34;status&#34;</span>, <span style="color:#c41a16">&#34;chembl_id&#34;</span>, <span style="color:#c41a16">&#34;pubchem_sid&#34;</span>, <span style="color:#c41a16">&#34;pubchem_cid&#34;</span>}
</span></span><span style="display:flex;"><span>        <span style="color:#000">tsvWrt</span>.<span style="color:#000">Write</span>(<span style="color:#000">tsvHeader</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// Implement a streaming XML parser according to guide in
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>        <span style="color:#177500">// http://blog.davidsingleton.org/parsing-huge-xml-files-with-go
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>        <span style="color:#000">xmlDec</span> <span style="color:#000">:=</span> <span style="color:#000">xml</span>.<span style="color:#000">NewDecoder</span>(<span style="color:#000">fh</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">for</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#000">t</span>, <span style="color:#000">tokenErr</span> <span style="color:#000">:=</span> <span style="color:#000">xmlDec</span>.<span style="color:#000">Token</span>()
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">if</span> <span style="color:#000">tokenErr</span> <span style="color:#000">!=</span> <span style="color:#a90d91">nil</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">if</span> <span style="color:#000">tokenErr</span> <span style="color:#000">==</span> <span style="color:#000">io</span>.<span style="color:#000">EOF</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#a90d91">break</span>
</span></span><span style="display:flex;"><span>                } <span style="color:#a90d91">else</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#000">sp</span>.<span style="color:#000">Fail</span>(<span style="color:#c41a16">&#34;Failed to read token:&#34;</span>, <span style="color:#000">tokenErr</span>)
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">switch</span> <span style="color:#000">startElem</span> <span style="color:#000">:=</span> <span style="color:#000">t</span>.(<span style="color:#a90d91">type</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">case</span> <span style="color:#000">xml</span>.<span style="color:#000">StartElement</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">if</span> <span style="color:#000">startElem</span>.<span style="color:#000">Name</span>.<span style="color:#000">Local</span> <span style="color:#000">==</span> <span style="color:#c41a16">&#34;drug&#34;</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#a90d91">var</span> <span style="color:#000">status</span> <span style="color:#a90d91">string</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#a90d91">var</span> <span style="color:#000">inchiKey</span> <span style="color:#a90d91">string</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#a90d91">var</span> <span style="color:#000">chemblID</span> <span style="color:#a90d91">string</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#a90d91">var</span> <span style="color:#000">pubchemSID</span> <span style="color:#a90d91">string</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#a90d91">var</span> <span style="color:#000">pubchemCID</span> <span style="color:#a90d91">string</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000">drug</span> <span style="color:#000">:=</span> <span style="color:#000">&amp;</span><span style="color:#000">Drug</span>{}
</span></span><span style="display:flex;"><span>                    <span style="color:#000">decErr</span> <span style="color:#000">:=</span> <span style="color:#000">xmlDec</span>.<span style="color:#000">DecodeElement</span>(<span style="color:#000">drug</span>, <span style="color:#000">&amp;</span><span style="color:#000">startElem</span>)
</span></span><span style="display:flex;"><span>                    <span style="color:#a90d91">if</span> <span style="color:#000">err</span> <span style="color:#000">!=</span> <span style="color:#a90d91">nil</span> {
</span></span><span style="display:flex;"><span>                        <span style="color:#000">sp</span>.<span style="color:#000">Fail</span>(<span style="color:#c41a16">&#34;Could not decode element&#34;</span>, <span style="color:#000">decErr</span>)
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                    <span style="color:#a90d91">for</span> <span style="color:#000">_</span>, <span style="color:#000">g</span> <span style="color:#000">:=</span> <span style="color:#a90d91">range</span> <span style="color:#000">drug</span>.<span style="color:#000">Groups</span> {
</span></span><span style="display:flex;"><span>                        <span style="color:#a90d91">if</span> <span style="color:#000">g</span> <span style="color:#000">==</span> <span style="color:#c41a16">&#34;approved&#34;</span> {
</span></span><span style="display:flex;"><span>                            <span style="color:#000">status</span> = <span style="color:#c41a16">&#34;A&#34;</span>
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                        <span style="color:#177500">// Withdrawn till &#34;shadow&#34; (what&#39;s the correct term?) approved status
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>                        <span style="color:#a90d91">if</span> <span style="color:#000">g</span> <span style="color:#000">==</span> <span style="color:#c41a16">&#34;withdrawn&#34;</span> {
</span></span><span style="display:flex;"><span>                            <span style="color:#000">status</span> = <span style="color:#c41a16">&#34;W&#34;</span>
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                    <span style="color:#a90d91">for</span> <span style="color:#000">_</span>, <span style="color:#000">p</span> <span style="color:#000">:=</span> <span style="color:#a90d91">range</span> <span style="color:#000">drug</span>.<span style="color:#000">CalculatedProperties</span> {
</span></span><span style="display:flex;"><span>                        <span style="color:#a90d91">if</span> <span style="color:#000">p</span>.<span style="color:#000">Kind</span> <span style="color:#000">==</span> <span style="color:#c41a16">&#34;InChIKey&#34;</span> {
</span></span><span style="display:flex;"><span>                            <span style="color:#000">inchiKey</span> = <span style="color:#000">p</span>.<span style="color:#000">Value</span>
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#a90d91">for</span> <span style="color:#000">_</span>, <span style="color:#000">eid</span> <span style="color:#000">:=</span> <span style="color:#a90d91">range</span> <span style="color:#000">drug</span>.<span style="color:#000">ExternalIdentifiers</span> {
</span></span><span style="display:flex;"><span>                        <span style="color:#a90d91">if</span> <span style="color:#000">eid</span>.<span style="color:#000">Resource</span> <span style="color:#000">==</span> <span style="color:#c41a16">&#34;ChEMBL&#34;</span> {
</span></span><span style="display:flex;"><span>                            <span style="color:#000">chemblID</span> = <span style="color:#000">eid</span>.<span style="color:#000">Identifier</span>
</span></span><span style="display:flex;"><span>                        } <span style="color:#a90d91">else</span> <span style="color:#a90d91">if</span> <span style="color:#000">eid</span>.<span style="color:#000">Resource</span> <span style="color:#000">==</span> <span style="color:#c41a16">&#34;PubChem Substance&#34;</span> {
</span></span><span style="display:flex;"><span>                            <span style="color:#000">pubchemSID</span> = <span style="color:#000">eid</span>.<span style="color:#000">Identifier</span>
</span></span><span style="display:flex;"><span>                        } <span style="color:#a90d91">else</span> <span style="color:#a90d91">if</span> <span style="color:#000">eid</span>.<span style="color:#000">Resource</span> <span style="color:#000">==</span> <span style="color:#c41a16">&#34;PubChem Compound&#34;</span> {
</span></span><span style="display:flex;"><span>                            <span style="color:#000">pubchemCID</span> = <span style="color:#000">eid</span>.<span style="color:#000">Identifier</span>
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000">tsvWrt</span>.<span style="color:#000">Write</span>([]<span style="color:#a90d91">string</span>{<span style="color:#000">inchiKey</span>, <span style="color:#000">status</span>, <span style="color:#000">chemblID</span>, <span style="color:#000">pubchemSID</span>, <span style="color:#000">pubchemCID</span>})
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">case</span> <span style="color:#000">xml</span>.<span style="color:#000">EndElement</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">continue</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000">tsvWrt</span>.<span style="color:#000">Flush</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#000">fh</span>.<span style="color:#000">Close</span>()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>(Code license: <a href="https://unlicense.org/" target="_blank" rel="noopener">Public Domain</a>
)</p>
<hr>
<ul>
<li>
<p><strong>Note I (2018-03-21):</strong> <a href="https://twitter.com/yokofakun" target="_blank" rel="noopener">Pierre Lindenbaum</a>

<a href="https://twitter.com/yokofakun/status/976488405654736896" target="_blank" rel="noopener">kindly suggested</a>

an <a href="https://gist.github.com/lindenb/5a76d95397a86b860386cdf3976726a2" target="_blank" rel="noopener">alternative
approach</a>

using the
<a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/xjc.html" target="_blank" rel="noopener">xjc</a>

tool to generate Java code, and a Makefile to provide for workflow
functionality (<a href="https://gist.github.com/lindenb/5a76d95397a86b860386cdf3976726a2" target="_blank" rel="noopener">see
code</a>
).  He
also <a href="https://twitter.com/yokofakun/status/976515166002204673" target="_blank" rel="noopener">provided a
version</a>
 implemented
with XSLT (<a href="https://gist.github.com/lindenb/63c85ee0e8c21b6cc3e7d44b77dd93db" target="_blank" rel="noopener">see
code</a>
).</p>
</li>
<li>
<p><strong>Note II (2018-03-21):</strong> <a href="https://www.reddit.com/r/golang/comments/854zl8/data_science_parsing_drugbank_xml_or_any_large" target="_blank" rel="noopener">Some comments on the post on
reddit</a>
.</p>
</li>
<li>
<p><strong>Edit 2018-03-20:</strong> Clarification of general usefulness of parsing the
DrugBank XML in the intro.</p>
</li>
<li>
<p><strong>Edit 2018-06-16:</strong> Update code examples to new <a href="https://github.com/scipipe/scipipe/releases/tag/v0.7" target="_blank" rel="noopener">SciPipe 0.7
API</a>
 (Use From()
instead of Connect() for connections)</p>
</li>
<li>
<p><strong>Edit 2019-03-02:</strong> Update code examples to new <a href="https://github.com/scipipe/scipipe/releases/tag/v0.8.0" target="_blank" rel="noopener">SciPipe 0.8
API</a>
 (Use
SetOut() instead of SetPathStatic(), SetPathExtend() etc)</p>
</li>
</ul>

  
  <div>
    <ul class="tags">
        <li><a href="/tags/xml/" class="tag">Xml</a></li>
        <li><a href="/tags/drugbank/" class="tag">Drugbank</a></li>
        <li><a href="/tags/go/" class="tag">Go</a></li>
    </ul>
  </div>


  <div id="disqus_thread"></div>
  <script>
  

  var disqus_config = function () {
      this.page.url = "https://livesys.se/posts/parsing-drugbank-xml-or-any-large-xml-file-in-streaming-mode-in-go/";  
      this.page.identifier =  1082 ; 
  };
  (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://bionicsit.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
  })();

  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  </main>
  <footer>
    <p>Content licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></p>

<p>Copyright &copy; 2025 Samuel Lampa</p>

<p>Find me on
<a href="https://orcid.org/0000-0001-6740-9212" target="_blank">ORCID</a>,
<a href="https://github.com/samuell" target="_blank">GitHub</a>,
<a href="https://twitter.com/smllmp" target="_blank">Twitter</a>,
<a href="https://bsky.app/profile/smllmp.bsky.social" target="_blank">BlueSky</a> or
<a href="https://linkedin.com/in/smllmp" target="_blank">LinkedIn</a>.
</p>

  </footer>
</body>
</html>
